<!-- Right Annotations and References Panel -->
<div class="reference-panel">
  
  <!-- Table of Contents -->
  <div class="panel-section toc-section">
    <h3 class="panel-heading">Table of Contents</h3>
    <div class="panel-content" id="toc-content">
      <!-- TOC will be generated by JavaScript -->
    </div>
  </div>

  <!-- Document Metadata -->
  <div class="panel-section metadata-section">
    <h3 class="panel-heading">Document Info</h3>
    <div class="panel-content">
      <dl class="metadata-list">
        {% if page.taxonomy %}
        <dt>Category</dt>
        <dd>
          {% assign category = site.data.taxonomy.categories | where: "id", page.taxonomy.category | first %}
          {{ category.name_ko }}
        </dd>
        {% endif %}

        {% if page.keywords %}
        <dt>Keywords</dt>
        <dd>
          {% for keyword in page.keywords %}
          <span class="keyword-tag">{{ keyword }}</span>
          {% endfor %}
        </dd>
        {% endif %}

        {% if page.difficulty %}
        <dt>Difficulty</dt>
        <dd>
          {% assign level = site.data.taxonomy.difficulty_levels | where: "id", page.difficulty | first %}
          <span class="difficulty-badge difficulty-{{ page.difficulty }}">{{ level.name_ko }}</span>
        </dd>
        {% endif %}

        <dt>Views</dt>
        <dd>
          <span id="busuanzi_container_page_pv">
            <span id="busuanzi_value_page_pv"></span> views
          </span>
        </dd>
      </dl>
    </div>
  </div>

  <!-- Prerequisites -->
  {% if page.relationships.prerequisite %}
  <div class="panel-section prerequisites-section">
    <h3 class="panel-heading">üìö Prerequisites</h3>
    <div class="panel-content">
      <ul class="reference-list">
        {% for prereq_path in page.relationships.prerequisite %}
          {% assign prereq = site.documents | where: "path", prereq_path | first %}
          {% if prereq %}
          <li>
            <a href="{{ prereq.url | relative_url }}" class="reference-link">
              {{ prereq.title }}
            </a>
          </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}

  <!-- Cross References -->
  {% if page.relationships.references %}
  <div class="panel-section cross-ref-section">
    <h3 class="panel-heading">üìñ References</h3>
    <div class="panel-content">
      <ul class="reference-list">
        {% for ref_path in page.relationships.references %}
          {% assign ref = site.documents | where: "path", ref_path | first %}
          {% if ref %}
          <li>
            <a href="{{ ref.url | relative_url }}" class="reference-link">
              {{ ref.title }}
            </a>
          </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}

  <!-- Quick Links -->
  <div class="panel-section quick-links-section">
    <h3 class="panel-heading">Quick Actions</h3>
    <div class="panel-content">
      <ul class="quick-links-list">
        <li>
          <a href="#" class="quick-link" id="copy-permalink">
            <span class="link-icon">üîó</span>
            <span class="link-text">Copy Permalink</span>
          </a>
        </li>
        <li>
          <a href="#" class="quick-link" id="print-document">
            <span class="link-icon">üñ®Ô∏è</span>
            <span class="link-text">Print Document</span>
          </a>
        </li>
        <li>
          <a href="https://github.com/gg582/gg582.github.io/edit/main/{{ page.path }}" class="quick-link" target="_blank">
            <span class="link-icon">‚úèÔ∏è</span>
            <span class="link-text">Suggest Edit</span>
          </a>
        </li>
      </ul>
    </div>
  </div>

</div>

<script>
// Generate Table of Contents
document.addEventListener('DOMContentLoaded', function() {
  const content = document.querySelector('.kb-document-body');
  const tocContainer = document.getElementById('toc-content');
  
  if (content && tocContainer) {
    const headings = content.querySelectorAll('h2, h3, h4');
    
    if (headings.length > 0) {
      const tocList = document.createElement('ul');
      tocList.className = 'toc-list';
      
      headings.forEach((heading, index) => {
        // Add ID for anchor linking
        if (!heading.id) {
          heading.id = 'section-' + index;
        }
        
        const li = document.createElement('li');
        li.className = 'toc-item toc-' + heading.tagName.toLowerCase();
        
        const a = document.createElement('a');
        a.href = '#' + heading.id;
        a.textContent = heading.textContent;
        a.className = 'toc-link';
        
        li.appendChild(a);
        tocList.appendChild(li);
      });
      
      tocContainer.appendChild(tocList);
    } else {
      tocContainer.innerHTML = '<p class="no-toc">No headings found</p>';
    }
  }

  // Copy permalink functionality
  const copyPermalink = document.getElementById('copy-permalink');
  if (copyPermalink) {
    copyPermalink.addEventListener('click', function(e) {
      e.preventDefault();
      const permalink = window.location.href;
      navigator.clipboard.writeText(permalink).then(() => {
        alert('Permalink copied to clipboard');
      });
    });
  }

  // Print document functionality
  const printDoc = document.getElementById('print-document');
  if (printDoc) {
    printDoc.addEventListener('click', function(e) {
      e.preventDefault();
      window.print();
    });
  }
});
</script>
