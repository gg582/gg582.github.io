<!-- ç›¸é—œæ–‡ç» (Related Documents Section) -->
<div class="related-documents">
  <h3 class="section-heading">ç›¸é—œæ–‡ç»</h3>

  {% assign has_relations = false %}

  <!-- Prerequisites (å…ˆä¿®çŸ¥è­˜) -->
  {% if page.relationships.prerequisite %}
  {% assign has_relations = true %}
  <div class="relation-group">
    <h4 class="relation-type">ğŸ“š å…ˆä¿®çŸ¥è­˜</h4>
    <p class="relation-description">é–±è®€æœ¬æ–‡å‰å»ºè­°å…ˆç†è§£çš„æ¦‚å¿µ</p>
    <ul class="document-list">
      {% for prereq_path in page.relationships.prerequisite %}
        {% assign prereq = site.documents | where: "path", prereq_path | first %}
        {% if prereq %}
        <li class="document-item">
          <a href="{{ prereq.url | relative_url }}" class="document-link">
            <span class="document-title">{{ prereq.title }}</span>
            {% if prereq.taxonomy %}
            {% assign cat = site.data.taxonomy.categories | where: "id", prereq.taxonomy.category | first %}
            <span class="document-category">{{ cat.icon }} {{ cat.name_ko }}</span>
            {% endif %}
          </a>
        </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Related Documents (é—œè¯æ–‡ç») -->
  {% if page.relationships.related %}
  {% assign has_relations = true %}
  <div class="relation-group">
    <h4 class="relation-type">ğŸ”— é—œè¯æ–‡ç»</h4>
    <p class="relation-description">ç›¸åŒä¸»é¡Œæˆ–æ¦‚å¿µçš„æ–‡ç»</p>
    <ul class="document-list">
      {% for related_path in page.relationships.related %}
        {% assign related = site.documents | where: "path", related_path | first %}
        {% if related %}
        <li class="document-item">
          <a href="{{ related.url | relative_url }}" class="document-link">
            <span class="document-title">{{ related.title }}</span>
            {% if related.taxonomy %}
            {% assign cat = site.data.taxonomy.categories | where: "id", related.taxonomy.category | first %}
            <span class="document-category">{{ cat.icon }} {{ cat.name_ko }}</span>
            {% endif %}
          </a>
        </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Extended Concepts (æ“´å±•æ¦‚å¿µ) -->
  {% if page.relationships.extends %}
  {% assign has_relations = true %}
  <div class="relation-group">
    <h4 class="relation-type">ğŸ“ˆ æ“´å±•æ¦‚å¿µ</h4>
    <p class="relation-description">æœ¬æ–‡æ¦‚å¿µçš„æ·±åŒ–èˆ‡å»¶ä¼¸</p>
    <ul class="document-list">
      {% for extend_path in page.relationships.extends %}
        {% assign extend = site.documents | where: "path", extend_path | first %}
        {% if extend %}
        <li class="document-item">
          <a href="{{ extend.url | relative_url }}" class="document-link">
            <span class="document-title">{{ extend.title }}</span>
            {% if extend.taxonomy %}
            {% assign cat = site.data.taxonomy.categories | where: "id", extend.taxonomy.category | first %}
            <span class="document-category">{{ cat.icon }} {{ cat.name_ko }}</span>
            {% endif %}
          </a>
        </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Comparison Documents (æ¯”è¼ƒæ–‡ç») -->
  {% if page.relationships.comparison %}
  {% assign has_relations = true %}
  <div class="relation-group">
    <h4 class="relation-type">âš–ï¸ æ¯”è¼ƒæ–‡ç»</h4>
    <p class="relation-description">å°ç…§åˆ†æçš„ç›¸é—œæŠ€è¡“æˆ–æ¦‚å¿µ</p>
    <ul class="document-list">
      {% for comp_path in page.relationships.comparison %}
        {% assign comp = site.documents | where: "path", comp_path | first %}
        {% if comp %}
        <li class="document-item">
          <a href="{{ comp.url | relative_url }}" class="document-link">
            <span class="document-title">{{ comp.title }}</span>
            {% if comp.taxonomy %}
            {% assign cat = site.data.taxonomy.categories | where: "id", comp.taxonomy.category | first %}
            <span class="document-category">{{ cat.icon }} {{ cat.name_ko }}</span>
            {% endif %}
          </a>
        </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Auto-suggested related documents (same category/subcategory) -->
  {% unless has_relations %}
  <div class="relation-group">
    <h4 class="relation-type">ğŸ”— åŒé¡æ–‡ç»</h4>
    <p class="relation-description">ç›¸åŒåˆ†é¡çš„å…¶ä»–æ–‡ç»</p>
    <ul class="document-list">
      {% assign related_docs = site.documents | where_exp: "doc", "doc.taxonomy.category == page.taxonomy.category" | where_exp: "doc", "doc.url != page.url" | sample: 5 %}
      {% for doc in related_docs limit: 5 %}
      <li class="document-item">
        <a href="{{ doc.url | relative_url }}" class="document-link">
          <span class="document-title">{{ doc.title }}</span>
          {% if doc.taxonomy %}
          {% assign cat = site.data.taxonomy.categories | where: "id", doc.taxonomy.category | first %}
          <span class="document-category">{{ cat.icon }} {{ cat.name_ko }}</span>
          {% endif %}
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endunless %}
</div>
